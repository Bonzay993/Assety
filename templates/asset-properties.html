{% extends "inventory.html" %}
{% block content %}

    <section class="heading-section">
        <div class="assets-list-top-container default-list-top-container">
            <h1>{{ trans('edit_asset') }} {{ asset.asset_tag if asset else ''  }}</h1>
        </div>
    </section>  
    <section class="new-asset-form-container default-form-container ">
       
        <form class="edit-asset-form default-form" action="{{ url_for('save_asset') }}" method="POST"  enctype="multipart/form-data"
        id="asset-form">
            <div class="edit-asset-form-main-container">
                <div class="edit-asset-form-data-container">
                    <input type="hidden" name="asset_id" value="{{ asset._id if asset else '' }}">  <!-- Store ID -->
                    <div class="form-group">
                        <label for="asset-tag">{{ trans('asset_tag') }}</label>
                        <input type="text" id="asset-tag" name="asset-tag" value="{{ asset.asset_tag if asset else ''  }}" required>
                    </div>

                    <div class="form-group">
                        <label for="category">{{ trans('category') }}</label>
                        <select id="category" name="category" required>
                            {% if not asset or not asset.category %}
                                <option value="">{{ trans('select_category') }}</option>
                            {% endif %}
                            {% for category in categories %}
                                <option value="{{ category.name }}"
                                    {% if asset and asset.category == category.name %}selected{% endif %}>
                                    {{ category.name }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="serial">{{ trans('serial_number') }}</label>
                        <input type="text" id="serial" name="serial" value="{{ asset.serial }}" required>
                    </div>

                    <div class="form-group">
                        <label for="model">{{ trans('model') }}</label>
                        <input type="text" id="model" name="model" value="{{ asset.model }}" required>
                    </div>

                    <div class="form-group">
                        <label for="notes">{{ trans('notes') }}</label>
                        <textarea id="notes" name="notes" placeholder="{{ trans('notes_placeholder') }}" {{ asset.notes }} rows="4"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="warranty">{{ trans('warranty_expiry') }}</label>
                        <div class="date-wrapper" onclick="document.getElementById('warranty').showPicker()">
                            <input type="date" id="warranty" name="warranty" value="{{ asset.warranty }}">
                        </div>
                    </div>
                    

                    <div class="form-group">
                         <label for="order-number">{{ trans('order_number') }}</label>
                        <input type="text" id="order-number" name="order-number" value="{{ asset.order_number }}" >
                    </div>

                    <div class="form-group purchase-cost">
                        <label for="purchase-cost">{{ trans('purchase_cost') }}</label>
                        <input type="text" id="purchase-cost" name="purchase-cost" value="{{ currency_symbol }}{{ asset.purchase_cost if asset else '' }}" placeholder="{{ currency_symbol }}">
                    </div>

                    <div class="form-group">
                        <label for="purchase-date">{{ trans('purchase_date') }}</label>
                        <div class="date-wrapper" onclick="document.getElementById('purchase-date').showPicker()">
                            <input type="date" id="purchase-date" name="purchase-date">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="location">{{ trans('location') }}</label>
                        <select id="location" name="location" required>
                            <option value="">{{ trans('select_location') }}</option>
                            {% for location in locations %}
                                <option value="{{ location.location_tag }}" 
                                    {% if asset and asset.location == location.location_tag %}selected{% endif %}>
                                    {{ location.location_tag }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="asset-image">{{ trans('upload_asset_image') }}</label>
                        <input type="file" id="asset-image" name="image" accept="image/*">
                    </div>
                </div>
                <div class="edit-asset-thumbnail-wrapper">
                    <div class="edit-asset-thumbnail-container">
                        <div class="edit-asset-thumbnail-container">
                            {% if asset.image_id %}
                                <img src="{{ url_for('get_image', image_id=asset.image_id) }}"
                                    alt="Asset Image"
                                    class="edit-asset-thumbnail">
                            {% else %}
                                <img src="{{ url_for('static', filename='img/no-image.jpg') }}"
                                    alt="No Image"
                                    class="asset-thumbnail">
                            {% endif %}
                        </div>
                    </div>
                </div>
               
             </div>
             <div class="form-actions">
                <a href="javascript:window.history.back()" class="form-cancel">{{ trans('cancel') }}</a>
                <button type="submit" class="btn save-btn"><i class="fa-solid fa-check"></i> {{ trans('save') }}</button>
            </div>
           
            
        </form>
      
    
    </section>


    <script>
      
        document.getElementById('asset-form').addEventListener('submit', function(event) {
            //  prevent form submission if required fields are missing or invalid
            const form = event.target;
            const fields = form.querySelectorAll('[required]');
            let valid = true;

            fields.forEach(function(field) {
                if (!field.value) {
                    valid = false;
                    field.classList.add('error');
                } else {
                    field.classList.remove('error');
                }
            });

            if (!valid) {
                event.preventDefault();
                alert("{{ trans('required_fields_alert') }}");
            }
        });
    </script>



{% endblock %}